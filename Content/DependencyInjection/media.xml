<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <parameters>
        <parameter type="collection" key="shopware.media.metadata.types">
            <parameter type="string">\Shopware\Core\Content\Media\Metadata\Type\ImageMetadata</parameter>
            <parameter type="string">\Shopware\Core\Content\Media\Metadata\Type\DocumentMetadata</parameter>
            <parameter type="string">\Shopware\Core\Content\Media\Metadata\Type\VideoMetadata</parameter>
        </parameter>
    </parameters>
    <services>
        <service class="Shopware\Core\Content\Media\MediaDefinition" id="Shopware\Core\Content\Media\MediaDefinition">
            <tag name="shopware.entity.definition" entity="media"/>
        </service>

        <service class="Shopware\Core\Content\Media\Aggregate\MediaThumbnail\MediaThumbnailDefinition" id="Shopware\Core\Content\Media\Aggregate\Thumbnail\ThumbnailDefinition">
            <tag name="shopware.entity.definition" entity="media_thumbnail"/>
        </service>

        <service class="Shopware\Core\Content\Media\Aggregate\MediaTranslation\MediaTranslationDefinition" id="Shopware\Core\Content\Media\Aggregate\MediaTranslation\MediaTranslationDefinition">
            <tag name="shopware.entity.definition" entity="media_translation"/>
        </service>

        <service class="Shopware\Core\Content\Media\Subscriber\MediaLoadedSubscriber" id="Shopware\Core\Content\Media\Subscriber\MediaLoadedSubscriber">
            <argument type="service" id="Shopware\Core\Content\Media\Pathname\UrlGeneratorInterface"/>
            <argument type="service" id="Shopware\Core\Content\Media\Metadata\MetadataLoader"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service class="Shopware\Core\Content\Media\Pathname\UrlGenerator" id="Shopware\Core\Content\Media\Pathname\UrlGeneratorInterface">
            <argument type="service" id="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PathnameStrategyInterface"/>
            <argument type="service" id="request_stack"/>
            <argument>%shopware.cdn.url%</argument>
        </service>

        <service class="Shopware\Core\Content\Media\Pathname\PathnameStrategy\StrategyFactory" id="Shopware\Core\Content\Media\Pathname\PathnameStrategy\StrategyFactory">
            <argument type="tagged" tag="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PathnameStrategyInterface"/>
        </service>

        <service class="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PathnameStrategyInterface" id="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PathnameStrategyInterface">
            <factory service="Shopware\Core\Content\Media\Pathname\PathnameStrategy\StrategyFactory" method="factory"/>
            <argument>%shopware.cdn.strategy%</argument>
        </service>

        <service class="Shopware\Core\Content\Media\File\FileFetcher" id="Shopware\Core\Content\Media\File\FileFetcher">
        </service>

        <service class="Shopware\Core\Content\Media\File\FileSaver" id="Shopware\Core\Content\Media\File\FileSaver" public="true">
            <argument type="service" id="media.repository"/>
            <argument type="service" id="shopware.filesystem.public"/>
            <argument type="service" id="Shopware\Core\Content\Media\Pathname\UrlGeneratorInterface"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="Shopware\Core\Content\Media\Metadata\MetadataLoader"/>
        </service>

        <service class="Shopware\Core\Content\Media\Subscriber\MediaDeletedSubscriber" id="Shopware\Core\Content\Media\Subscriber\MediaDeletedSubscriber">
            <argument type="service" id="shopware.filesystem.public"/>
            <argument type="service" id="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PathnameStrategyInterface"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Commands -->
        <service class="Shopware\Core\Content\Media\Commands\GenerateThumbnailsCommand" id="Shopware\Core\Content\Media\Commands\GenerateThumbnailsCommand">
            <argument type="service" id="Shopware\Core\Content\Media\Thumbnail\ThumbnailService"/>
            <argument type="service" id="media.repository"/>
            <tag name="console.command"/>
        </service>

        <service class="Shopware\Core\Content\Media\Commands\MediaMigrateCommand" id="Shopware\Core\Content\Media\Commands\MediaMigrateCommand">
            <argument type="service" id="Shopware\Core\Framework\Filesystem\PrefixFilesystem"/>
            <argument type="service" id="Shopware\Core\Content\Media\Pathname\PathnameStrategy\StrategyFactory"/>
            <argument type="service" id="event_dispatcher"/>
            <tag name="console.command"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Pathname strategies -->
        <service class="Shopware\Core\Content\Media\Pathname\PathnameStrategy\Md5PathnameStrategy" id="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PathnameStrategyInterface.md5">
            <tag name="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PathnameStrategyInterface"/>
        </service>

        <service class="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PlainPathnameStrategy" id="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PathnameStrategyInterface.plain">
            <tag name="Shopware\Core\Content\Media\Pathname\PathnameStrategy\PathnameStrategyInterface"/>
        </service>

        <service class="Shopware\Core\Content\Media\Api\MediaUploadController" id="Shopware\Core\Content\Media\Api\MediaUploadController" public="true">
            <argument type="service" id="Shopware\Core\Content\Media\File\FileFetcher"/>
            <argument type="service" id="Shopware\Core\Content\Media\File\FileSaver"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <service class="Shopware\Core\Content\Media\Thumbnail\ThumbnailConfiguration"
                 id="Shopware\Core\Content\Media\Thumbnail\ThumbnailConfiguration">
            <factory class="Shopware\Core\Content\Media\Thumbnail\ThumbnailConfiguration" method="getDefaultThumbnailConfiguration"/>
        </service>

        <service class="Shopware\Core\Content\Media\Thumbnail\ThumbnailService" id="Shopware\Core\Content\Media\Thumbnail\ThumbnailService">
            <argument type="service" id="media.repository"/>
            <argument type="service" id="shopware.filesystem.public"/>
            <argument type="service" id="Shopware\Core\Content\Media\Pathname\UrlGeneratorInterface"/>
            <argument type="service" id="Shopware\Core\Content\Media\Thumbnail\ThumbnailConfiguration"/>

            <tag name="kernel.event_subscriber"/>
        </service>

        <!-- Metadata -->
        <service class="Shopware\Core\Content\Media\Metadata\MetadataLoader\GetId3Loader" id="Shopware\Core\Content\Media\Metadata\MetadataLoader\GetId3Loader">
            <tag name="\Shopware\Core\Content\Media\Metadata\MetadataLoader\MetadataLoaderInterface"/>
        </service>
        <service class="Shopware\Core\Content\Media\Metadata\MetadataLoader\PdfParserLoader" id="Shopware\Core\Content\Media\Metadata\MetadataLoader\PdfParserLoader">
            <tag name="\Shopware\Core\Content\Media\Metadata\MetadataLoader\MetadataLoaderInterface"/>
        </service>
        <service class="Shopware\Core\Content\Media\Metadata\MetadataLoader\WordLoader" id="Shopware\Core\Content\Media\Metadata\MetadataLoader\WordLoader">
            <tag name="\Shopware\Core\Content\Media\Metadata\MetadataLoader\MetadataLoaderInterface"/>
        </service>
        <service class="Shopware\Core\Content\Media\Metadata\MetadataLoader" id="Shopware\Core\Content\Media\Metadata\MetadataLoader">
            <argument type="tagged" tag="\Shopware\Core\Content\Media\Metadata\MetadataLoader\MetadataLoaderInterface"/>
            <argument>%shopware.media.metadata.types%</argument>
        </service>
    </services>
</container>
